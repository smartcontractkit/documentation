---
import changelogData from "../../public/changelog.json"
import { marked } from "marked"

export type Props = {
  topic: string
  subTopic?: string
}

export interface ChangelogEntry {
  category: string
  changes?: string[]
  date: string
  description: string
  relatedNetworks?: string[]
  relatedTokens?: string[]
  title: string
  topic: string
  subTopic?: string
  urls?: string[]
}

const changelog: ChangelogEntry[] = changelogData

const { topic, subTopic } = Astro.props as Props

const entries = changelog.filter(
  (entry) => (entry.topic === topic && !subTopic) || (subTopic && entry.subTopic === subTopic)
)
---

{
  entries.map((entry) => (
    <section>
      <h2 id={entry.date + "-" + entry.title.toLowerCase().replace(/ /g, "-")}>
        <a href={`#${entry.date}-${entry.title.toLowerCase().replace(/ /g, "-")}`}>
          {entry.date} - {entry.title}
        </a>
      </h2>
      <article set:html={marked.parse(entry.description)} />
    </section>
  ))
}
