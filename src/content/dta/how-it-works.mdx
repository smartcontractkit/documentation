---
section: dta
title: "How It Works"
---

import { ClickToZoom, Aside } from "@components"
import Dta from "@features/dta/common/Dta.astro"

<Dta section="dtaNotes" />

The Digital Transfer Agent (DTA) system facilitates a secure and transparent workflow for the distribution and redemption of tokenized funds. At a high level, the process involves two main smart contracts and a clear, four-step process for subscriptions.

## The key contracts in the flow

A typical DTA transaction involves two primary smart contracts working in concert:

- **`DTAOpenMarketplace`**: The public-facing contract that serves as a global hub for discovering funds and submitting requests.
- **`DTAWallet`**: The private vault contract, owned by a Fund Administrator, that handles the secure settlement of requests.

This separation of public and private logic is fundamental to the protocol. For a deep dive into the specific design and responsibilities of each component, see the detailed [Architecture](/dta/concepts/architecture) page.

## The subscription flow

A typical subscription (buy) order follows a clear, four-step process that moves from the distributor to the marketplace, to the admin's wallet, and back.

<ClickToZoom
  src="/images/DTA/subscription-flow.png"
  caption="High-level overview of the DTA contract interactions for a typical subscription flow."
/>

1. **Request Submission:** A registered and allowlisted Fund Distributor calls the `requestSubscription` function on the `DTAOpenMarketplace` contract. They specify which fund they want to invest in and the amount of payment currency they wish to use.

1. **Request Processing:** At a predetermined time (e.g., end of day), the Fund Administrator initiates processing by calling the `processDistributorRequest` function. The `DTAOpenMarketplace` then performs two key actions:

   - **Price Calculation:** It calls a Chainlink Data Feed to fetch the fund's official Net Asset Value (NAV) and calculates the exact number of shares to be issued.
   - **Request Forwarding:** It forwards the finalized request, including the calculated share amount, to the Fund Administrator's `DTAWallet` contract.

1. **Token Minting & Escrow:** The `DTAWallet` receives the request and calls the `mint` function on the associated Fund Token contract.

   <Aside type="note" title="A critical compliance checkpoint">
     At this point, the token contract itself can enforce its own compliance rules (for example, using Chainlink ACE to
     verify the `DTAWallet`'s permissions and the distributor's eligibility). Upon a successful compliance check, the
     new shares are created and held in escrow by the `DTAWallet` itself, pending final payment settlement.
   </Aside>

1. **Settlement:** The final step is settlement. Depending on the fund's payment model, the `DTAWallet` coordinates the transfer of payment from the distributor and, upon successful settlement, releases the newly minted fund tokens from escrow to the distributor's wallet.

Each of these steps corresponds to a formal status change in the DTA system. To see a detailed breakdown of these states, from `Pending` to `Processed`, see the [The Request Lifecycle](/dta/concepts/request-lifecycle) page.

## The redemption flow

The process for redemptions (selling shares) follows a similar four-step lifecycle in reverse: a distributor requests to redeem shares, the administrator processes the request, the `DTAWallet` burns the shares, and finally settles the payment.

The key operational difference is that for onchain settlements, the **Fund Administrator's `DTAWallet` must be funded with the payment token** to send to the distributor.

## Flexible settlement models

The final "Settlement" step of the flow can occur in one of three ways, depending on how the fund is configured:

- **Offchain Settlement:** The `DTAWallet` escrows the tokens while payment is made through traditional channels (e.g., a wire transfer). The administrator then manually confirms receipt onchain.
- **Local Onchain Settlement:** The entire process, from payment transfer to token minting, happens atomically in a single transaction on one blockchain.
- **Cross-Chain Settlement:** The request is made on one chain, and Chainlink CCIP is used to securely transfer payment and instructions to the `DTAWallet` on another chain for final settlement. This model allows a fund to exist on a single primary blockchain while being accessible to distributors across many different networks, enabling operational patterns like taking requests on a low-cost L2 while the fund itself is administered on an L1.

To learn more about the specific workflows for each of these models, see the [Payment Modes](/dta/concepts/payment-modes) page.
