---
import { getCollection } from "astro:content"

type Props = {
  to: string
}

export async function getStaticPaths() {
  const normalizeTutorialId = (entryId: string): string => {
    let id = entryId.replace(/\.(md|mdx)$/, "")
    id = id.replace(/\/index$/, "")
    // Astro content slugs may collapse dots: v2.0 → v20
    id = id.replace(/^(v2\.0|v20)\/tutorials\/?/, "")
    return id
  }

  const entries = await getCollection(
    "ccip",
    (entry) =>
      entry.id === "v2.0/tutorials" ||
      entry.id.startsWith("v2.0/tutorials/") ||
      entry.id === "v20/tutorials" ||
      entry.id.startsWith("v20/tutorials/")
  )

  const paths: { params: { id?: string }; props: Props }[] = []

  for (const entry of entries) {
    const tutorialId = normalizeTutorialId(entry.id)

    // /ccip/tutorials → /ccip/v2.0/tutorials
    if (!tutorialId) {
      paths.push({
        params: { id: undefined },
        props: { to: "/ccip/v2.0/tutorials" },
      })
      continue
    }

    // /ccip/tutorials/* → /ccip/v2.0/tutorials/*
    paths.push({
      params: { id: tutorialId },
      props: { to: `/ccip/v2.0/tutorials/${tutorialId}` },
    })
  }

  return paths
}

const { to } = Astro.props as Props
---

<meta name="robots" content="noindex, follow" />
<meta http-equiv="refresh" content={`0; url=${to}`} />
